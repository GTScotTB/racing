<!DOCTYPE html>
<html>
<head>
    <title>Map CSV Columns</title>
    <style>
        .mapping-container {
            margin: 20px;
        }
        .mapping-row {
            margin: 15px 0;
            display: flex;
            align-items: center;
        }
        .mapping-row label {
            width: 150px;
            font-weight: bold;
        }
        select {
            width: 200px;
            padding: 5px;
        }
        .submit-button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="mapping-container">
        <h1>Map Database Fields to CSV Columns</h1>
        
        <form action="{{ url_for('preview_data') }}" method="POST" id="mappingForm">
            <!-- Store the raw data as stringified JSON -->
            <input type="hidden" id="rawCsvData" name="raw_csv_data" value="">
            <input type="hidden" id="rawCsvHeaders" name="raw_csv_headers" value="">
            
            {% for db_col in db_columns %}
            <div class="mapping-row">
                <label>{{ db_col|replace('_', ' ')|title }}:</label>
                <select name="mapping[{{ db_col }}]">
                    <option value="">-- Select CSV Column --</option>
                    {% for header in csv_headers %}
                    <option value="{{ header }}">{{ header }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endfor %}
            
            <div class="submit-button">
                <button type="submit">Preview Data</button>
            </div>
        </form>
        
        <div style="margin-top: 20px;">
            <h3>Available CSV Columns:</h3>
            <ul>
                {% for header in csv_headers %}
                <li>{{ header }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <script>
        // Store the data as JavaScript variables
        const csvData = {{ csv_data|tojson|safe }};
        const csvHeaders = {{ csv_headers|tojson|safe }};
        
        // When the form is submitted, add the data to the hidden fields
        document.getElementById('mappingForm').onsubmit = function() {
            document.getElementById('rawCsvData').value = JSON.stringify(csvData);
            document.getElementById('rawCsvHeaders').value = JSON.stringify(csvHeaders);
            
            // Debug output
            console.log('Submitting data:', {
                csvData: csvData,
                csvHeaders: csvHeaders
            });
            
            return true;
        };
    </script>
</body>
</html> 