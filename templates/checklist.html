<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="messages">
        {% for category, message in messages %}
        <div class="alert {{ category }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <header>
        <h1>Checklist</h1>
        <p>Driver: {{ entry.driver_name }}</p>
        <p>Vehicle Number: {{ entry.vehicle_number }}</p>
    </header>    
    <form action="/update_checklist" method="POST">
        <input type="hidden" name="checklist_id" value="{{ checklist.id }}">
        <!-- CSRF token for security -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <!-- Button to Set All Dropdowns to "Pass" -->
        <button type="button" onclick="setAllToPass()">Set All to Pass</button>

        <table border="1">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Status</th>
                    <th>Brand (if required)</th>
                    <th>Standard (if required)</th>
                    <th>Expiry Date (if required)</th>
                    <th>ROPS (if required)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Render the checklist items -->
                {% for item in items %}
                {% if item.item_name not in ["Scrutineer Name", "Scrutineer Licence Number"] %}
                <tr>
                    <td>{{ item.item_name }}</td>
                    <td>
                        {% if item.item_name == "Vehicle Weight" %}
                        <!-- Number input for Vehicle Weight -->
                        <input type="number" name="vehicle_weight_{{ item.id }}" 
                               value="{{ item.value or '' }}" step="0.1" required>
                        {% else %}
                            {% if item.item_name == "Date" %}
                            <!-- Auto-populated Date -->
                            <input type="text" name="date" value="{{ current_date }}" readonly>
                            {% else %}
                                {% if item.item_name == "Time" %}
                                <!-- Auto-populated Time -->
                                <input type="text" name="time" value="{{ current_time }}" readonly>
                                {% else %}
                                <!-- Dropdown for other items -->
                                <select name="status_{{ item.id }}" required>
                                    <option value="Pending" {% if item.status == "Pending" %}selected{% endif %}>Pending</option>
                                    <option value="Pass" {% if item.status == "Pass" %}selected{% endif %}>Pass</option>
                                    <option value="Fail" {% if item.status == "Fail" %}selected{% endif %}>Fail</option>
                                    <option value="NA" {% if item.status == "NA" %}selected{% endif %}>N/A</option>
                                </select>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if item.brand_required %}
                        <input type="text" name="brand_{{ item.id }}" value="{{ item.brand }}">
                        {% else %}
                        <!-- Blank -->
                        {% endif %}
                    </td>
                    <td>
                        {% if item.standard_required %}
                        <input type="text" name="standard_{{ item.id }}" value="{{ item.standard }}">
                        {% else %}
                        <!-- Blank -->
                        {% endif %}
                    </td>
                    <td>
                        {% if item.expiry_date_required %}
                        <input type="date" name="expiry_date_{{ item.id }}" value="{{ item.expiry_date }}">
                        {% else %}
                        <!-- Blank -->
                        {% endif %}
                    </td>
                    <td>
                        {% if item.rops_required %}
                        <input type="text" name="rops_{{ item.id }}" value="{{ item.rops }}">
                        {% else %}
                        <!-- Blank -->
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            
                <!-- Add rows for Scrutineer Name, Licence Number, Date, and Time -->
                <tr>
                    <td>Scrutineer Name</td>
                    <td>
                      <select id="scrutineer-name-dropdown" name="scrutineer_name" onchange="updateLicenceNumber()" required>
                        <option value="" disabled selected>Select a Scrutineer</option>
                        {% for scrutineer in scrutineers %}
                        <option value="{{ scrutineer.id }}" data-licence-number="{{ scrutineer.licence_number }}" 
                          {% if scrutineer.id == checklist.scrutineer_name %}selected{% endif %}>
                          {{ scrutineer.name }}
                        </option>
                        {% endfor %}
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <td>Scrutineer Licence Number</td>
                    <td>
                      <select id="scrutineer-licence-dropdown" name="scrutineer_licence_number" required>
                        <option value="" disabled selected>Select Licence Number</option>
                        {% for scrutineer in scrutineers %}
                        <option value="{{ scrutineer.licence_number }}" 
                          {% if scrutineer.licence_number == checklist.scrutineer_licence_number %}selected{% endif %}>
                          {{ scrutineer.licence_number }}
                        </option>
                        {% endfor %}
                      </select>
                    </td>
                  </tr>
            </tbody>
        </table>
        
        <button type="submit">Save Changes</button>
    </form>

    <button onclick="window.location.href='/lookup_entry'">Back to Lookup</button>
    <button onclick="window.location.href='/'">HOME</button>

<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>